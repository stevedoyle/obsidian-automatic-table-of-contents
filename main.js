// Automatic Table Of Contents (SD) 0.2.0 (https://github.com/stevedoyle)
var u=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var c=u((ue,x)=>{var v=class{},w={},b=class{},y=class{},k=class{},L=n=>n;if(W()){let n=require("obsidian");v=n.Plugin,w=n.MarkdownRenderer,b=n.MarkdownRenderChild,y=n.PluginSettingTab,k=n.Setting,L=n.htmlToMarkdown}x.exports={Plugin:v,MarkdownRenderer:w,MarkdownRenderChild:b,PluginSettingTab:y,Setting:k,htmlToMarkdown:L};function W(){return typeof process!="object"?!0:!process.env||!process.env.JEST_WORKER_ID}});var T=u((me,M)=>{var o={title:{type:"string",default:"",comment:""},style:{type:"value",default:"nestedList",values:["nestedList","nestedOrderedList","inlineFirstLevel"],comment:"TOC style (nestedList|nestedOrderedList|inlineFirstLevel)"},minLevel:{type:"number",default:0,comment:"Include headings from the specified level"},maxLevel:{type:"number",default:0,comment:"Include headings up to the specified level"},include:{type:"regexp",default:null,comment:""},exclude:{type:"regexp",default:null,comment:""},includeLinks:{type:"boolean",default:!0,comment:"Make headings clickable"},hideWhenEmpty:{type:"boolean",default:!1,comment:"Hide TOC if no headings are found"},debugInConsole:{type:"boolean",default:!1,comment:"Print debug info in Obsidian console"}};M.exports={getOptionsDocs:_,parseOptionsFromSourceText:R};function _(){let n=[];for(let e of Object.keys(o)){let t=o[e],l=t.comment.length>0?` # ${t.comment}`:"",s=t.default!==null?t.default:"";n.push(`${e}: ${s}${l}`)}return n.join(`
`)}function R(n="",e=null){let t={};if(e)t.title=e.defaultTitle,t.style=e.defaultStyle,t.minLevel=e.defaultMinLevel,t.maxLevel=e.defaultMaxLevel,t.includeLinks=e.defaultIncludeLinks,t.hideWhenEmpty=e.defaultHideWhenEmpty,t.include=o.include.default,t.exclude=o.exclude.default,t.debugInConsole=o.debugInConsole.default;else for(let l of Object.keys(o))t[l]=o[l].default;for(let l of n.split(`
`)){let s=V(l);s!==null&&(t[s.name]=s.value)}return t}function V(n){let e=n.match(/([a-zA-Z0-9._ ]+):(.*)/);if(n.startsWith("#")||!e)return null;let t=e[1].trim(),l=o[t],s=e[2].trim();(!l||!["string","regexp"].includes(l.type))&&(s=s.replace(/#[^#]*$/,"").trim());let r=new Error(`Invalid value for \`${t}\``);if(l&&l.type==="number"){let a=Number.parseInt(s);if(a<0)throw r;return{name:t,value:a}}if(l&&l.type==="boolean"){if(!["true","false"].includes(s))throw r;return{name:t,value:s==="true"}}if(l&&l.type==="value"){if(!l.values.includes(s))throw r;return{name:t,value:s}}if(l&&l.type==="string")return s==="null"||s==='""'||s==="''"?{name:t,value:""}:{name:t,value:s};if(l&&l.type==="regexp"){if(s==="null"||s.length===0)return null;try{let a=/^\/(.*)\/([a-z]*)/.exec(s);if(!a)throw new Error("Invalid regexp");let i=new RegExp(a[1],a[2]);return{name:t,value:i}}catch{throw r}}return null}});var $=u((pe,I)=>{var{htmlToMarkdown:j}=c();I.exports={isHeadingAllowed:q,getFormattedMarkdownHeading:B};function q(n,e){return e.include?e.include.test(n):e.exclude?!e.exclude.test(n):!0}function B(n,e){if(e.includeLinks){let t=n;t=S(t),t=U(t),t=C(t,!1);let l=n;return l=C(l,!0),l=z(l),`[[#${l}|${t}]]`}return n}function S(n){return n.replaceAll("*","").replaceAll(/(\W|^)_+(\S)(.*?\S)?_+(\W|$)/g,"$1$2$3$4").replaceAll("`","").replaceAll("==","").replaceAll("~~","").replace(/\[([^\]]+)\]\([^)]+\)/g,"$1")}function U(n){return S(j(n))}function C(n,e){return n.replace(/\[\[([^\]]+)\|([^\]]+)\]\]/g,e?"$1 $2":"$2").replace(/\[\[([^\]]+)\]\]/g,"$1").replaceAll("[[","").replaceAll("| ",e?"":"- ").replaceAll("|",e?" ":"-")}function z(n){return n.replaceAll("#"," ")}});var H=u((ve,E)=>{var{isHeadingAllowed:D,getFormattedMarkdownHeading:N}=$();E.exports={getMarkdownFromHeadings:G};function G(n,e){let t={nestedList:J,nestedOrderedList:K,inlineFirstLevel:Z},l="";if(e.title&&e.title.length>0){let r=e.style==="inlineFirstLevel"?" ":`
`;l+=`${e.title}${r}`}let s=t[e.style](n,e);return s===null?e.hideWhenEmpty?"":`${l}_Table of contents: no headings found_`:l+s}function J(n,e){return O(n,!1,e)}function K(n,e){return O(n,!0,e)}function O(n,e,t){let l=e?"1.":"-",s=[],r=t.minLevel>0?t.minLevel:Math.min(...n.map(i=>i.level)),a=0;for(let i of n)if(!(a>0&&i.level>a)){if(i.level<=a&&(a=0),!D(i.heading,t)){a=i.level;continue}i.level<r||t.maxLevel>0&&i.level>t.maxLevel||i.heading.length!==0&&s.push(`${"	".repeat(i.level-r)}${l} ${N(i.heading,t)}`)}return s.length>0?s.join(`
`):null}function Z(n,e){let t=e.minLevel>0?e.minLevel:Math.min(...n.map(s=>s.level)),l=n.filter(s=>s.level===t).filter(s=>s.heading.length>0).filter(s=>D(s.heading,e)).map(s=>N(s.heading,e));return l.length>0?l.join(" | "):null}});var P=u((we,F)=>{var{PluginSettingTab:Q,Setting:d}=c(),X={defaultTitle:"## Table of Contents",defaultStyle:"nestedList",defaultMinLevel:0,defaultMaxLevel:0,defaultIncludeLinks:!0,defaultHideWhenEmpty:!1},f=class extends Q{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"Automatic Table of Contents Settings"}),new d(e).setName("Default title").setDesc("Default title to display before the table of contents (supports Markdown). Use empty string for no title.").addText(t=>t.setPlaceholder("## Table of Contents").setValue(this.plugin.settings.defaultTitle).onChange(async l=>{this.plugin.settings.defaultTitle=l,await this.plugin.saveSettings()})),new d(e).setName("Default style").setDesc("Default table of contents style").addDropdown(t=>t.addOption("nestedList","Nested List").addOption("nestedOrderedList","Nested Ordered List").addOption("inlineFirstLevel","Inline First Level").setValue(this.plugin.settings.defaultStyle).onChange(async l=>{this.plugin.settings.defaultStyle=l,await this.plugin.saveSettings()})),new d(e).setName("Default minimum level").setDesc("Include headings from the specified level (0 for no limit)").addText(t=>t.setPlaceholder("0").setValue(String(this.plugin.settings.defaultMinLevel)).onChange(async l=>{let s=Number.parseInt(l);!Number.isNaN(s)&&s>=0&&(this.plugin.settings.defaultMinLevel=s,await this.plugin.saveSettings())})),new d(e).setName("Default maximum level").setDesc("Include headings up to the specified level (0 for no limit)").addText(t=>t.setPlaceholder("0").setValue(String(this.plugin.settings.defaultMaxLevel)).onChange(async l=>{let s=Number.parseInt(l);!Number.isNaN(s)&&s>=0&&(this.plugin.settings.defaultMaxLevel=s,await this.plugin.saveSettings())})),new d(e).setName("Default include links").setDesc("Make headings clickable by default").addToggle(t=>t.setValue(this.plugin.settings.defaultIncludeLinks).onChange(async l=>{this.plugin.settings.defaultIncludeLinks=l,await this.plugin.saveSettings()})),new d(e).setName("Default hide when empty").setDesc("Hide table of contents if no headings are found by default").addToggle(t=>t.setValue(this.plugin.settings.defaultHideWhenEmpty).onChange(async l=>{this.plugin.settings.defaultHideWhenEmpty=l,await this.plugin.saveSettings()}))}};F.exports={DEFAULT_SETTINGS:X,SettingsTab:f}});var{Plugin:Y,MarkdownRenderer:A,MarkdownRenderChild:ee}=c(),{getOptionsDocs:te,parseOptionsFromSourceText:ne}=T(),{getMarkdownFromHeadings:le}=H(),{DEFAULT_SETTINGS:se,SettingsTab:ie}=P(),p="table-of-contents",ae="toc",h=class extends Y{async onload(){await this.loadSettings();let e=(t,l,s)=>{s.addChild(new m(this.app,l,s.sourcePath,t,this.settings))};this.registerMarkdownCodeBlockProcessor(p,e),this.registerMarkdownCodeBlockProcessor(ae,e),this.addCommand({id:"insert-automatic-table-of-contents",name:"Insert table of contents",editorCallback:re}),this.addCommand({id:"insert-automatic-table-of-contents-docs",name:"Insert table of contents (with available options)",editorCallback:oe}),this.addSettingTab(new ie(this.app,this))}async loadSettings(){this.settings=Object.assign({},se,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};function re(n){let e=`\`\`\`${p}
\`\`\``;n.replaceRange(e,n.getCursor())}function oe(n){let e=[`\`\`\`${p}
${te()}
\`\`\``];n.replaceRange(e.join(`
`),n.getCursor())}var m=class extends ee{constructor(e,t,l,s,r){super(t),this.app=e,this.element=t,this.sourcePath=l,this.sourceText=s,this.pluginSettings=r}onload(){this.render(),this.registerEvent(this.app.metadataCache.on("changed",this.onMetadataChange.bind(this)))}onMetadataChange(){this.render()}render(){try{let e=ne(this.sourceText,this.pluginSettings);e.debugInConsole&&g("Options",e);let t=this.app.metadataCache.getCache(this.sourcePath),l=t?.headings?t.headings:[];e.debugInConsole&&g("Headings",l);let s=le(l,e);e.debugInConsole&&g("Markdown",s),this.element.empty(),A.renderMarkdown(s,this.element,this.sourcePath,this)}catch(e){let t=`_\u{1F4A5} Could not render table of contents (${e.message})_`;A.renderMarkdown(t,this.element,this.sourcePath,this)}}};function g(n,e){console.log(`%cAutomatic Table Of Contents %c${n}:
`,"color: orange; font-weight: bold","font-weight: bold",e)}module.exports=h;
